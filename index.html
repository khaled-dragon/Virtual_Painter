<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Virtual Painter - Web</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <style>
        body {
            background-color: #001f3f;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .blur-bg {
            position: absolute;
            width: 600px;
            height: 600px;
            background: rgba(0, 48, 143, 0.4);
            filter: blur(150px);
            z-index: -1;
        }
        .container {
            position: relative;
            width: 1280px;
            height: 720px;
        }
        canvas {
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0,0,0,0.7);
        }
        #status {
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin-top: 20px;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            transition: all 0.3s ease;
            text-shadow: 0 0 10px #0074D9, 0 0 20px #0074D9, 0 0 30px #001f3f;
            animation: glow 1.5s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px #0074D9, 0 0 20px #0074D9; }
            to { text-shadow: 0 0 20px #0074D9, 0 0 40px #001f3f, 0 0 60px #0074D9; }
        }
    </style>
</head>
<body>
    <div class="blur-bg"></div>
    <div class="container">
        <canvas id="output_canvas" width="1280" height="720"></canvas>
    </div>
    <div id="status">Initializing AI...</div>

    <script>
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const statusElement = document.getElementById('status');

        const drawCanvas = document.createElement('canvas');
        drawCanvas.width = 1280;
        drawCanvas.height = 720;
        const drawCtx = drawCanvas.getContext('2d');

        const headerImages = [];
        const imagePaths = ['Header/1.png', 'Header/2.png', 'Header/3.png', 'Header/4.png'];
        let currentHeader = new Image();
        
        imagePaths.forEach((path, index) => {
            const img = new Image();
            img.src = path;
            headerImages[index] = img;
            if(index === 0) currentHeader = img;
        });

        let xp = 0, yp = 0;
        let drawColor = "#594BE9"; 
        let brushThickness = 25;
        let eraserThickness = 100;

        function onResults(results) {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, 1280, 720);
            
            canvasCtx.translate(1280, 0);
            canvasCtx.scale(-1, 1);
            canvasCtx.drawImage(results.image, 0, 0, 1280, 720);

            if (results.multiHandLandmarks) {
                for (const landmarks of results.multiHandLandmarks) {
                    
                    drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 5});
                    drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 2});

                    const x1 = (1 - landmarks[8].x) * 1280;
                    const y1 = landmarks[8].y * 720;
                    const x2 = (1 - landmarks[12].x) * 1280;
                    const y2 = landmarks[12].y * 720;

                    const isIndexUp = landmarks[8].y < landmarks[6].y;
                    const isMiddleUp = landmarks[12].y < landmarks[10].y;

                    canvasCtx.setTransform(1, 0, 0, 1, 0, 0);

                    if (isIndexUp && isMiddleUp) {
                        xp = 0; yp = 0;
                        statusElement.innerText = "Selection Mode";
                        
                        if (y1 < 125) {
                            if (x1 > 250 && x1 < 450) {
                                drawColor = "#E94B59";
                                currentHeader = headerImages[0];
                            } else if (x1 > 480 && x1 < 650) {
                                drawColor = "#3A5CD3";
                                currentHeader = headerImages[1];
                            } else if (x1 > 680 && x1 < 900) {
                                drawColor = "#08B257";
                                currentHeader = headerImages[2];
                            } else if (x1 > 950 && x1 < 1200) {
                                drawColor = "#000000";
                                currentHeader = headerImages[3];
                            }
                        }
                        canvasCtx.fillStyle = drawColor;
                        canvasCtx.beginPath();
                        canvasCtx.roundRect(x1, y1 - 25, x2 - x1, 50, 10);
                        canvasCtx.fill();

                    } else if (isIndexUp) {
                        statusElement.innerText = "Drawing Mode";
                        canvasCtx.beginPath();
                        canvasCtx.arc(x1, y1, 15, 0, 2 * Math.PI);
                        canvasCtx.fillStyle = drawColor;
                        canvasCtx.fill();

                        if (xp == 0 && yp == 0) { xp = x1; yp = y1; }

                        drawCtx.beginPath();
                        drawCtx.moveTo(xp, yp);
                        drawCtx.lineTo(x1, y1);
                        
                        if (drawColor === "#000000") {
                            drawCtx.globalCompositeOperation = 'destination-out';
                            drawCtx.lineWidth = eraserThickness;
                        } else {
                            drawCtx.globalCompositeOperation = 'source-over';
                            drawCtx.strokeStyle = drawColor;
                            drawCtx.lineWidth = brushThickness;
                        }

                        drawCtx.lineCap = 'round';
                        drawCtx.stroke();
                        xp = x1; yp = y1;
                    } else {
                        xp = 0; yp = 0;
                    }
                    canvasCtx.translate(1280, 0);
                    canvasCtx.scale(-1, 1);
                }
            }

            canvasCtx.setTransform(1, 0, 0, 1, 0, 0);
            canvasCtx.drawImage(drawCanvas, 0, 0);
            if(currentHeader.complete) {
                canvasCtx.drawImage(currentHeader, 0, 0, 1280, 125);
            }
            canvasCtx.restore();
        }

        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.65, minTrackingConfidence: 0.5});
        hands.onResults(onResults);

        const video = document.createElement('video');
        const camera = new Camera(video, {
            onFrame: async () => { await hands.send({image: video}); },
            width: 1280, height: 720
        });
        camera.start();
    </script>
</body>
</html>